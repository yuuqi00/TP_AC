import math          # Import du module math (utilisé pour infini)
import itertools
import time
import sys



cities = [
    'Algiers',
    'Constantine',
    'Batna',
    'Sétif',
    'Djelfa',
    'Annaba',
    'Sidi Aïssa',
    'Sidi Bel Abbès',
    'Biskra',
    'Tébessa',
    'Ouargla',
    'El Khroub',
    'Tiaret',
    'Bejaïa',
    'Tlemcen',
    'Bir el Djir',
    'Bordj Bou Arreridj',
    'Béchar',
    'Blida',
    'Skikda',
    'Souk Ahras',
    'Chlef',
    'El Eulma',
    'Bordj el Kiffan',
    'Mostaganem',
    'Touggourt',
    'Médéa',
    'Tizi Ouzou',
    'El Oued',
    'Laghouat',
    'M’Sila',
    'Jijel',
    'Relizane',
    'Saïda',
    'Baraki',
    'Guelma',
    'Ghardaïa',
    'Aïn Beïda',
    'Maghnia',
    'Bou Saâda',
    'Bou Saada',
    'Mascara',
    'Khenchela',
    'Barika',
    'Messaad',
    'Aflou',
    'Aïn Oussera',
    'Oran'
]

distance_matrix = [
    [0, 319, 309, 219, 232, 419, 114, 375, 320, 478, 572, 329, 219, 178, 445, 343, 170, 749, 37, 342, 440, 167, 244, 12, 281, 490, 60, 88, 511, 328, 177, 239, 251, 338, 10, 391, 478, 402, 480, 198, 135, 302, 395, 256, 290, 306, 145, 351],  # Algiers
    [319, 0, 97, 108, 356, 120, 206, 665, 184, 172, 503, 12, 488, 144, 733, 646, 167, 967, 337, 63, 121, 472, 85, 307, 586, 364, 345, 231, 333, 441, 198, 91, 548, 606, 314, 75, 507, 94, 770, 252, 185, 592, 114, 153, 371, 478, 347, 654],  # Constantine
    [309, 97, 0, 98, 282, 207, 198, 618, 87, 177, 407, 93, 439, 166, 683, 607, 138, 890, 316, 160, 180, 441, 79, 297, 550, 272, 317, 230, 251, 358, 147, 145, 507, 552, 302, 151, 411, 112, 721, 184, 196, 546, 88, 74, 287, 404, 295, 614],  # Batna
    [219, 108, 98, 0, 258, 224, 105, 557, 151, 259, 471, 116, 380, 69, 625, 539, 59, 867, 233, 152, 228, 366, 24, 207, 479, 348, 238, 134, 341, 351, 94, 76, 440, 499, 213, 183, 442, 183, 662, 156, 97, 483, 177, 88, 284, 379, 240, 546],  # Sétif
    [232, 356, 282, 258, 0, 477, 224, 359, 227, 450, 357, 359, 192, 283, 417, 365, 207, 611, 203, 410, 462, 240, 275, 230, 320, 312, 183, 239, 363, 102, 164, 328, 272, 283, 222, 427, 245, 395, 455, 103, 262, 295, 363, 209, 60, 122, 92, 371],  # Djelfa
    [419, 120, 207, 224, 477, 0, 312, 779, 292, 169, 594, 118, 603, 241, 848, 756, 283, 1088, 442, 77, 70, 580, 203, 407, 695, 449, 453, 331, 402, 561, 317, 179, 659, 723, 416, 58, 617, 128, 884, 373, 283, 705, 174, 272, 491, 599, 465, 764],  # Annaba
    [114, 206, 198, 105, 224, 312, 0, 468, 224, 364, 514, 216, 296, 73, 537, 443, 63, 808, 131, 235, 327, 268, 130, 102, 383, 411, 140, 32, 419, 326, 91, 134, 347, 417, 108, 280, 450, 288, 574, 144, 39, 394, 282, 155, 269, 332, 171, 451],  # Sidi Aïssa
    [375, 665, 618, 557, 359, 779, 468, 0, 581, 794, 659, 673, 178, 541, 70, 60, 498, 423, 343, 702, 784, 208, 581, 385, 105, 659, 328, 454, 718, 357, 473, 602, 123, 82, 374, 741, 499, 729, 105, 437, 501, 73, 705, 545, 395, 278, 322, 55],  # Sidi Bel Abbès
    [320, 184, 87, 151, 227, 292, 224, 581, 0, 225, 324, 180, 405, 219, 643, 578, 161, 821, 317, 247, 256, 424, 144, 310, 526, 197, 312, 257, 195, 287, 143, 218, 480, 509, 311, 235, 325, 182, 680, 147, 237, 512, 142, 69, 218, 342, 265, 585],  # Biskra
    [478, 172, 177, 259, 450, 169, 364, 794, 225, 0, 462, 159, 616, 312, 859, 784, 311, 1045, 490, 196, 99, 617, 234, 466, 727, 317, 493, 393, 254, 511, 324, 264, 685, 727, 472, 131, 523, 78, 897, 358, 351, 723, 89, 249, 443, 567, 472, 792],  # Tébessa
    [572, 503, 407, 471, 357, 594, 514, 659, 324, 462, 0, 496, 530, 534, 696, 686, 460, 712, 551, 565, 539, 595, 468, 566, 654, 145, 535, 542, 213, 307, 423, 542, 608, 576, 562, 536, 166, 466, 729, 377, 539, 614, 420, 383, 299, 383, 448, 689],  # Ouargla
    [329, 12, 93, 116, 359, 118, 216, 673, 180, 159, 496, 0, 495, 155, 740, 655, 174, 970, 347, 69, 112, 481, 92, 317, 595, 356, 354, 242, 323, 443, 203, 104, 556, 613, 324, 68, 504, 81, 778, 256, 197, 599, 102, 154, 372, 481, 353, 662],  # El Khroub
    [219, 488, 439, 380, 192, 603, 296, 178, 405, 616, 530, 495, 0, 370, 245, 174, 321, 530, 183, 528, 606, 88, 403, 227, 128, 504, 163, 287, 555, 224, 294, 429, 80, 121, 215, 563, 387, 550, 282, 259, 332, 107, 527, 367, 239, 157, 144, 180],  # Tiaret
    [178, 144, 166, 69, 283, 241, 73, 541, 219, 312, 534, 155, 370, 0, 611, 516, 80, 879, 201, 163, 263, 340, 86, 166, 455, 416, 213, 90, 410, 383, 125, 61, 420, 491, 175, 214, 491, 234, 647, 189, 42, 467, 237, 152, 320, 397, 242, 524],  # Bejaïa
    [445, 733, 683, 625, 417, 848, 537, 70, 643, 859, 696, 740, 245, 611, 0, 117, 566, 372, 414, 772, 852, 278, 648, 455, 172, 708, 398, 525, 771, 403, 539, 672, 193, 133, 445, 809, 532, 795, 37, 501, 571, 143, 770, 610, 448, 324, 388, 109],  # Tlemcen
    [343, 646, 607, 539, 365, 756, 443, 60, 578, 784, 686, 655, 174, 516, 117, 0, 480, 483, 314, 679, 767, 176, 563, 353, 61, 674, 303, 427, 728, 379, 460, 577, 99, 119, 343, 721, 530, 716, 144, 432, 474, 72, 695, 536, 408, 302, 314, 8],  # Bir el Djir
    [170, 167, 138, 59, 207, 283, 63, 498, 161, 311, 460, 174, 321, 80, 566, 480, 0, 812, 179, 210, 286, 308, 82, 159, 421, 350, 182, 96, 356, 305, 45, 121, 381, 440, 163, 242, 411, 237, 603, 109, 79, 424, 225, 92, 240, 325, 181, 488],  # Bordj Bou Arreridj
    [749, 967, 890, 867, 611, 1088, 808, 423, 821, 1045, 712, 970, 530, 879, 372, 483, 812, 0, 712, 1020, 1071, 602, 886, 755, 524, 795, 690, 808, 872, 534, 773, 932, 524, 419, 744, 1038, 562, 1000, 363, 714, 847, 473, 963, 818, 604, 489, 637, 476],  # Béchar
    [37, 337, 316, 233, 203, 442, 131, 343, 317, 490, 551, 347, 183, 201, 414, 314, 179, 712, 0, 365, 458, 138, 257, 43, 253, 476, 23, 112, 504, 296, 176, 263, 220, 302, 32, 411, 449, 415, 449, 185, 159, 270, 404, 257, 263, 270, 113, 322],  # Blida
    [342, 63, 160, 152, 410, 77, 235, 702, 247, 196, 565, 69, 528, 163, 772, 679, 210, 1020, 365, 0, 113, 503, 134, 330, 618, 425, 376, 254, 389, 499, 247, 102, 582, 648, 339, 66, 569, 128, 808, 306, 206, 629, 162, 213, 429, 531, 391, 687],  # Skikda
    [440, 121, 180, 228, 462, 70, 327, 784, 256, 99, 539, 112, 606, 263, 852, 767, 286, 1071, 458, 113, 0, 593, 204, 428, 707, 393, 466, 351, 340, 538, 313, 205, 668, 723, 435, 49, 577, 75, 889, 361, 305, 711, 121, 253, 467, 583, 464, 774],  # Souk Ahras
    [167, 472, 441, 366, 240, 580, 268, 208, 424, 617, 595, 481, 88, 340, 278, 176, 308, 602, 138, 503, 593, 0, 390, 178, 115, 551, 127, 250, 593, 297, 294, 401, 85, 182, 167, 547, 462, 546, 312, 277, 298, 137, 529, 373, 296, 239, 162, 184],  # Chlef
    [244, 85, 79, 24, 275, 203, 130, 581, 144, 234, 468, 92, 403, 86, 648, 563, 82, 886, 257, 134, 204, 390, 0, 232, 504, 340, 263, 159, 328, 365, 113, 74, 464, 521, 238, 160, 447, 158, 686, 171, 119, 507, 154, 88, 296, 396, 262, 570],  # El Eulma
    [12, 307, 297, 207, 230, 407, 102, 385, 310, 466, 566, 317, 227, 166, 455, 353, 159, 755, 43, 330, 428, 178, 232, 0, 292, 481, 65, 76, 502, 327, 167, 227, 262, 346, 11, 379, 475, 390, 490, 191, 123, 312, 383, 245, 287, 308, 145, 362],  # Bordj el Kiffan
    [281, 586, 550, 479, 320, 695, 383, 105, 526, 727, 654, 595, 128, 455, 172, 61, 421, 524, 253, 618, 707, 115, 504, 292, 0, 632, 242, 365, 682, 347, 403, 516, 47, 122, 282, 661, 505, 657, 203, 378, 413, 59, 639, 480, 367, 273, 260, 69],  # Mostaganem
    [490, 364, 272, 348, 312, 449, 411, 659, 197, 317, 145, 356, 504, 416, 708, 674, 350, 795, 476, 425, 393, 551, 340, 481, 632, 0, 464, 442, 79, 306, 321, 414, 584, 578, 480, 392, 234, 321, 744, 292, 429, 602, 275, 263, 265, 383, 390, 678],  # Touggourt
    [60, 345, 317, 238, 183, 453, 140, 328, 312, 493, 535, 354, 163, 213, 398, 303, 182, 690, 23, 376, 466, 127, 263, 65, 242, 464, 0, 126, 495, 274, 173, 274, 206, 284, 54, 419, 429, 420, 434, 174, 172, 254, 406, 254, 243, 247, 92, 310],  # Médéa
    [88, 231, 230, 134, 239, 331, 32, 454, 257, 393, 542, 242, 287, 90, 525, 427, 96, 808, 112, 254, 351, 250, 159, 76, 365, 442, 126, 0, 452, 341, 121, 151, 332, 409, 84, 303, 472, 316, 560, 168, 47, 381, 312, 188, 287, 339, 174, 435],  # Tizi Ouzou
    [511, 333, 251, 341, 363, 402, 419, 718, 195, 254, 213, 323, 555, 410, 771, 728, 356, 872, 504, 389, 340, 593, 328, 502, 682, 79, 495, 452, 0, 372, 335, 397, 635, 639, 502, 347, 313, 273, 808, 321, 431, 657, 229, 264, 323, 447, 430, 733],  # El Oued
    [328, 441, 358, 351, 102, 561, 326, 357, 287, 511, 307, 443, 224, 383, 403, 379, 305, 534, 296, 499, 538, 297, 365, 327, 347, 306, 274, 341, 372, 0, 260, 424, 301, 275, 319, 508, 164, 466, 438, 196, 364, 307, 428, 288, 70, 79, 183, 383],  # Laghouat
    [177, 198, 147, 94, 164, 317, 91, 473, 143, 324, 423, 203, 294, 125, 539, 460, 45, 773, 176, 247, 313, 294, 113, 167, 403, 321, 173, 121, 335, 260, 0, 164, 360, 410, 168, 272, 366, 256, 577, 64, 118, 400, 236, 81, 195, 284, 151, 467],  # M’Sila
    [239, 91, 145, 76, 328, 179, 134, 602, 218, 264, 542, 104, 429, 61, 672, 577, 121, 932, 263, 102, 205, 401, 74, 227, 516, 414, 274, 151, 397, 424, 164, 0, 481, 550, 236, 155, 518, 186, 708, 228, 104, 528, 199, 161, 358, 446, 297, 585],  # Jijel
    [251, 548, 507, 440, 272, 659, 347, 123, 480, 685, 608, 556, 80, 420, 193, 99, 381, 524, 220, 582, 668, 85, 464, 262, 47, 584, 206, 332, 635, 301, 360, 481, 0, 106, 251, 623, 461, 616, 228, 333, 379, 52, 596, 437, 320, 229, 215, 106],  # Relizane
    [338, 606, 552, 499, 283, 723, 417, 82, 509, 727, 576, 613, 121, 491, 133, 119, 440, 419, 302, 648, 723, 182, 521, 346, 122, 578, 284, 409, 639, 275, 410, 550, 106, 0, 335, 682, 417, 664, 171, 368, 453, 63, 638, 478, 315, 196, 259, 119],  # Saïda
    [10, 314, 302, 213, 222, 416, 108, 374, 311, 472, 562, 324, 215, 175, 445, 343, 163, 744, 32, 339, 435, 167, 238, 11, 282, 480, 54, 84, 502, 319, 168, 236, 251, 335, 0, 387, 468, 396, 479, 188, 132, 301, 388, 247, 280, 298, 136, 351],  # Baraki
    [391, 75, 151, 183, 427, 58, 280, 741, 235, 131, 536, 68, 563, 214, 809, 721, 242, 1038, 411, 66, 49, 547, 160, 379, 661, 392, 419, 303, 347, 508, 272, 155, 623, 682, 387, 0, 560, 74, 846, 324, 256, 667, 118, 219, 437, 549, 422, 729],  # Guelma
    [478, 507, 411, 442, 245, 617, 450, 499, 325, 523, 166, 504, 387, 491, 532, 530, 411, 562, 449, 569, 577, 462, 447, 475, 505, 234, 429, 472, 313, 164, 366, 518, 461, 417, 468, 560, 0, 501, 565, 306, 483, 459, 456, 359, 187, 231, 337, 533],  # Ghardaïa
    [402, 94, 112, 183, 395, 128, 288, 729, 182, 78, 466, 81, 550, 234, 795, 716, 237, 1000, 415, 128, 75, 546, 158, 390, 657, 321, 420, 316, 273, 466, 256, 186, 616, 664, 396, 74, 501, 0, 832, 297, 273, 656, 46, 187, 396, 516, 406, 723],  # Aïn Beïda
    [480, 770, 721, 662, 455, 884, 574, 105, 680, 897, 729, 778, 282, 647, 37, 144, 603, 363, 449, 808, 889, 312, 686, 490, 203, 744, 434, 560, 808, 438, 577, 708, 228, 171, 479, 846, 565, 832, 0, 538, 607, 179, 808, 647, 485, 361, 426, 136],  # Maghnia
    [198, 252, 184, 156, 103, 373, 144, 437, 147, 358, 377, 256, 259, 189, 501, 432, 109, 714, 185, 306, 361, 277, 171, 191, 378, 292, 174, 168, 321, 196, 64, 228, 333, 368, 188, 324, 306, 297, 538, 0, 177, 367, 269, 110, 131, 225, 118, 438],  # Bou Saâda
    [135, 185, 196, 97, 262, 283, 39, 501, 237, 351, 539, 197, 332, 42, 571, 474, 79, 847, 159, 206, 305, 298, 119, 123, 413, 429, 172, 47, 431, 364, 118, 104, 379, 453, 132, 256, 483, 273, 607, 177, 0, 427, 273, 167, 305, 371, 210, 482],  # Bou Saada
    [302, 592, 546, 483, 295, 705, 394, 73, 512, 723, 614, 599, 107, 467, 143, 72, 424, 473, 270, 629, 711, 137, 507, 312, 59, 602, 254, 381, 657, 307, 400, 528, 52, 63, 301, 667, 459, 656, 179, 367, 427, 0, 634, 474, 336, 230, 251, 76],  # Mascara
    [395, 114, 88, 177, 363, 174, 282, 705, 142, 89, 420, 102, 527, 237, 770, 695, 225, 963, 404, 162, 121, 529, 154, 383, 639, 275, 406, 312, 229, 428, 236, 199, 596, 638, 388, 118, 456, 46, 808, 269, 273, 634, 0, 160, 359, 482, 383, 703],  # Khenchela
    [256, 153, 74, 88, 209, 272, 155, 545, 69, 249, 383, 154, 367, 152, 610, 536, 92, 818, 257, 213, 253, 373, 88, 245, 480, 263, 254, 188, 264, 288, 81, 161, 437, 478, 247, 219, 359, 187, 647, 110, 167, 474, 160, 0, 218, 330, 223, 543],  # Barika
    [290, 371, 287, 284, 60, 491, 269, 395, 218, 443, 299, 372, 239, 320, 448, 408, 240, 604, 263, 429, 467, 296, 296, 287, 367, 265, 243, 287, 323, 70, 195, 358, 320, 315, 280, 437, 187, 396, 485, 131, 305, 336, 359, 218, 0, 128, 152, 413],  # Messaad
    [306, 478, 404, 379, 122, 599, 332, 278, 342, 567, 383, 481, 157, 397, 324, 302, 325, 489, 270, 531, 583, 239, 396, 308, 273, 383, 247, 339, 447, 79, 284, 446, 229, 196, 298, 549, 231, 516, 361, 225, 371, 230, 482, 330, 128, 0, 166, 305],  # Aflou
    [145, 347, 295, 240, 92, 465, 171, 322, 265, 472, 448, 353, 144, 242, 388, 314, 181, 637, 113, 391, 464, 162, 262, 145, 260, 390, 92, 174, 430, 183, 151, 297, 215, 259, 136, 422, 337, 406, 426, 118, 210, 251, 383, 223, 152, 166, 0, 321],  # Aïn Oussera
    [351, 654, 614, 546, 371, 764, 451, 55, 585, 792, 689, 662, 180, 524, 109, 8, 488, 476, 322, 687, 774, 184, 570, 362, 69, 678, 310, 435, 733, 383, 467, 585, 106, 119, 351, 729, 533, 723, 136, 438, 482, 76, 703, 543, 413, 305, 321, 0]   # Oran
]

def display_percentage(i,n,start_time):
    #               100% --> n
    # elapsed_percentage --> i+1 => elapsed_percentage  = (i + 1) * 100 / n  
    elapsed_percentage   = (i + 1) * 100 / n
    remaining_percentage = 100 - elapsed_percentage 

    current_time = time.time()
    elapsed_time = current_time - start_time

    if elapsed_percentage  > 0:
        #    elapsed_time --> elapsed_percentage 
        #  remaining_time --> remaining_percentage => remaining_time = remaining_percentage * elapsed_time / elapsed_percentage 
        remaining_time = remaining_percentage * elapsed_time / elapsed_percentage 
    
    # Affiche la progression sur une seule ligne en écrasant l'affichage précédent.
    # \r ramène le curseur au début de la ligne, sys.stdout.write écrit le texte sans retour à la ligne,
    # et le formatage affiche le pourcentage, le temps écoulé et le temps restant estimé.
    sys.stdout.write(f"\rProgress: {elapsed_percentage :.2f}%, Elapsed Time: {elapsed_time:.2f}s, RemainingTime: {remaining_time:.2f}s")

    # Force l'affichage immédiat du texte (sinon Python peut attendre avant d'afficher).
    sys.stdout.flush()  

# --------------------------------------------------------------------
# Fonction à compléter : brute force TSP
# --------------------------------------------------------------------

def calculate_distance(route, distances):
    # route: 0 -> perm -> 0
    length = 0
    prev = 0
    for node in route:
        length += distances[prev][node]
        prev = node
    length += distances[prev][0]  # return to Alger
    return length

def brute_force_tsp(distances, cities):
    """
    distances : matrice NxN des distances entre les villes
    Retour attendu : (best_route, best_length)

    Les étudiants doivent :
    1. Fixer le point de départ (index 0 = Alger)
    2. Générer toutes les permutations des autres villes (1..n-1)
    3. Calculer la distance de chaque route
    4. Trouver la route minimale
    """
    n = len(cities)
    best_length = math.inf
    best_route = None
    for perm in itertools.permutations(range(1, n)):
        current_route = [0] + list(perm)
        length =calculate_distance(perm, distances)
        if length < best_length:
            best_length = length
            best_route = current_route

  
   

    return best_route, best_length         # retourner la meilleure solution trouvée

# --------------------------------------------------------------------
# Fonction à compléter : Plus Proche Voisin (Nearest Neighbor) TSP
# --------------------------------------------------------------------
def nearest_neighbor_tsp(distances, cities):
    """
    Écrire une fonction qui implémente l’approche du plus proche voisin pour générer une solution approximative au TSP.
    Cette fonction doit :

        - Prendre une ville de départ (indice) en paramètre.
        - Construire un circuit en choisissant à chaque étape la ville non visitée la plus proche.
        - Retourner le parcours complet et sa distance totale.
    """
    n = len(cities)
    visited = [False] * n

    current_city = 0          # départ : Alger
    visited[current_city] = True
    route = [current_city]
    total_distance = 0

    for _ in range(n - 1):
        nearest_city = None
        nearest_distance = math.inf

        for city in range(n):
            if not visited[city]:
                d = distances[current_city][city]
                if d < nearest_distance:
                    nearest_distance = d
                    nearest_city = city

        visited[nearest_city] = True
        route.append(nearest_city)
        total_distance += nearest_distance
        current_city = nearest_city

    # retour à la ville de départ
    total_distance += distances[current_city][0]
    route.append(0)

    return route, total_distance       

# --------------------------------------------------------------------
# Liste des 10 villes (leurs indices correspondent aux lignes/colonnes)
# --------------------------------------------------------------------
cities1 = [
    "Alger","Batna","Oran","Sétif","Constantine",
    "Tlemcen","Ouargla","Annaba","Béchar","Tizi-Ouzou"
]


# --------------------------------------------------------------------
# Matrice des distances entre les villes (symétrique)
# --------------------------------------------------------------------
D = [
    [0,   430, 415, 260, 320, 520, 770, 600, 970, 110],   # Alger
    [430,   0, 798, 100, 120, 620, 420, 300, 950, 350],   # Batna
    [415, 798,   0, 430, 500, 180, 850, 780, 720, 380],   # Oran
    [260, 100, 430,   0, 115, 500, 620, 310, 800, 250],   # Sétif
    [320, 120, 500, 115,   0, 550, 610, 160, 950, 340],   # Constantine
    [520, 620, 180, 500, 550,   0,1000, 720, 450, 540],   # Tlemcen
    [770, 420, 850, 620, 610,1000,   0, 720, 770, 640],   # Ouargla
    [600, 300, 780, 310, 160, 720, 720,   0,1150, 360],   # Annaba
    [970, 950, 720, 800, 950, 450, 770,1150,   0,1160],   # Béchar
    [110, 350, 380, 250, 340, 540, 640, 360,1160,   0]    # Tizi-Ouzou
]


# --------------------------------------------------------------------
# Appel de la fonction brute force
# --------------------------------------------------------------------
best_route, best_length = brute_force_tsp(distance_matrix, cities)


# --------------------------------------------------------------------
# Affichage du résultat
# --------------------------------------------------------------------
print("Best route :", best_route)      # les étudiants peuvent améliorer cet affichage
print("Best route length:", best_length)

route_nn, length_nn = nearest_neighbor_tsp(distance_matrix, cities)

print("Nearest Neighbor route :", route_nn)
print("Nearest Neighbor length:", length_nn)
